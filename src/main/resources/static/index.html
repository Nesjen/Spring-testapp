<!DOCTYPE html>
<html>
<head>
    <title>React to me</title>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/react/15.3.2/react.min.js"></script>
    <script src="https://fb.me/react-dom-15.0.1.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/babel-core/5.8.24/browser.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.1.1/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/toastr.js/2.1.3/toastr.min.js"></script>

</head>
<body>
<div id="myDiv"></div>

<p>JAX is depressed after getting voted down, and are now hiding <a href="/api/hello">here</a></p>
<script type="text/babel">



    var AjaxCall = React.createClass({
        intervalId: null,
        request: null,
        getInitialState: function() {
            return {
                data: null
            };
        },

        componentDidMount: function() {
            this.intervalId = setInterval(this.fetchData, 5000);
        },

        componentWillUnmount: function() {
            if (this.intervalId) {
                clearInterval(this.intervalId)
                this.intervalId = null;
            }

            if (this.request) {
                this.request.abort();
                this.request = null;
            }
        },

        fetchData: function() {
            this.request = $.ajax({
                url: "/user/users",
                type: "GET",
                contentType: 'application/json',
                data: JSON.stringify({
                    id: this.state.name,
                    name: this.state.email,
                }),
                success: function(result) {
                    console.log(result);
                    var d = 1;
                    this.setState({ data: d });
                }.bind(this)
            });
        },

        render: function() {
            // use this.state.data here however you need ot
            if (!this.state.data) {
                return <div>No data</div>
            }

            return <div>{this.state.data}</div>;
        }
    });

    ReactDOM.render(
            <AjaxCall />,
        document.getElementById('myDiv')
    );

</script>
</body>
</html>
